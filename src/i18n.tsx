import { createContext, useContext, useMemo, useState } from 'react';

type Lang = 'en' | 'ko' | 'zh-CN' | 'th';

type Dict = Record<string, string>;

const dictionaries: Record<Lang, Dict> = {
  en: {
    'legend.alliances': 'Alliances',
    'legend.filterByAlliance': 'Filter by alliance',
    'legend.holdings': 'Holdings',
    'legend.today': 'Today',
    'legend.details': 'Details',
    'legend.color': 'Color',
    'legend.priority': 'Priority',
    'legend.remove': 'Remove alliance',
    'legend.allianceName': 'Alliance name',
    'legend.pickColor': 'Pick color',
    'legend.add': 'Add',
    'blitz.title': 'City Blitz Planner',
    'blitz.modes.planning': 'Planning',
    'blitz.modes.action': 'Action',
    'toolbar.data': 'Data',
    'toolbar.actions': 'Actions',
    'toolbar.filters': 'Filters',
    'toolbar.theme': 'Theme',
    'btn.saveNow': 'Save now',
    'btn.reloadFromServer': 'Reload from server',
    'btn.exportAccountData': 'Export account data',
    'btn.export': 'Export',
    'btn.import': 'Import',
    'btn.shareMap': 'Share Map...',
    'controls.manualStepper': 'Manual stepper',
    'controls.capture': 'Capture',
    'controls.release': 'Release',
    'controls.play': 'Play',
    'controls.pause': 'Pause',
    'actions.clearFuture': 'Clear Future',
    'actions.clearAll': 'Clear All',
    'actions.undoClear': 'Undo Clear',
    'planning.clearPlan': 'Clear Plan',
    'planning.undoClearPlan': 'Undo Clear Plan',
    'filters.allianceFilter': 'Alliance filter',
    'filters.all': 'All',
    'theme.light': 'Light',
    'theme.dark': 'Dark',
    'strike.title': 'Faction Strike Planner',
    'tabs.active': 'Active',
    'tabs.proposed': 'Proposed',
    'tabs.history': 'History',
    'labels.myFaction': 'My Faction',
    'labels.targeting': 'Targeting',
    'ui.attackerSelect': 'Attacker alliance…',
    'ui.reset': 'Reset current cycle',
    'table.rank': '#',
    'table.target': 'Target',
    'table.interest': 'Interest',
    'table.action': 'Action',
    'bracket.b1': 'Bracket 1 (1–3)',
    'bracket.b2': 'Bracket 2 (4–6)',
    'bracket.b3': 'Bracket 3 (7–9)',
    'bracket.b4': 'Bracket 4 (10–12)',
    'bracket.b5': 'Bracket 5 (13–15)',
    'bracket.b6': 'Bracket 6 (16–18)',
    'bracket.b7': 'Bracket 7 (19–20)',
    'interest.none': 'None',
    'actions.interested': 'Interested',
    'actions.withdraw': 'Withdraw',
    'tooltips.markInterest': 'Mark interest',
    'tooltips.bracketMismatch': 'Bracket mismatch',
  },
  ko: {
    'legend.alliances': '연맹',
    'legend.filterByAlliance': '연맹으로 필터',
    'legend.holdings': '보유 수',
    'legend.today': '오늘',
    'legend.details': '자세히',
    'legend.color': '색상',
    'legend.priority': '우선순위',
    'legend.remove': '연맹 삭제',
    'legend.allianceName': '연맹 이름',
    'legend.pickColor': '색상 선택',
    'legend.add': '추가',
    'blitz.title': '시티 블리츠 플래너',
    'blitz.modes.planning': '계획',
    'blitz.modes.action': '실행',
    'toolbar.data': '데이터',
    'toolbar.actions': '작업',
    'toolbar.filters': '필터',
    'toolbar.theme': '테마',
    'btn.saveNow': '지금 저장',
    'btn.reloadFromServer': '서버에서 다시 불러오기',
    'btn.exportAccountData': '계정 데이터 내보내기',
    'btn.export': '내보내기',
    'btn.import': '가져오기',
    'btn.shareMap': '지도 공유...',
    'controls.manualStepper': '수동 단계',
    'controls.capture': '점령',
    'controls.release': '해제',
    'controls.play': '재생',
    'controls.pause': '일시정지',
    'actions.clearFuture': '미래 지우기',
    'actions.clearAll': '전체 지우기',
    'actions.undoClear': '되돌리기',
    'planning.clearPlan': '계획 지우기',
    'planning.undoClearPlan': '계획 되돌리기',
    'filters.allianceFilter': '연맹 필터',
    'filters.all': '전체',
    'theme.light': '라이트',
    'theme.dark': '다크',
    'strike.title': '진영 공격 플래너',
    'tabs.active': '진행 중',
    'tabs.proposed': '제안됨',
    'tabs.history': '기록',
    'labels.myFaction': '내 진영',
    'labels.targeting': '공격 대상',
    'ui.attackerSelect': '공격 동맹 선택…',
    'ui.reset': '현재 사이클 초기화',
    'table.rank': '#',
    'table.target': '대상',
    'table.interest': '관심',
    'table.action': '작업',
    'bracket.b1': '브래킷 1 (1–3)',
    'bracket.b2': '브래킷 2 (4–6)',
    'bracket.b3': '브래킷 3 (7–9)',
    'bracket.b4': '브래킷 4 (10–12)',
    'bracket.b5': '브래킷 5 (13–15)',
    'bracket.b6': '브래킷 6 (16–18)',
    'bracket.b7': '브래킷 7 (19–20)',
    'interest.none': '없음',
    'actions.interested': '관심표시',
    'actions.withdraw': '철회',
    'tooltips.markInterest': '관심 표시',
    'tooltips.bracketMismatch': '브래킷 불일치',
  },
  'zh-CN': {
    'legend.alliances': '联盟',
    'legend.filterByAlliance': '按联盟筛选',
    'legend.holdings': '占领数',
    'legend.today': '今日',
    'legend.details': '详情',
    'legend.color': '颜色',
    'legend.priority': '优先级',
    'legend.remove': '删除联盟',
    'legend.allianceName': '联盟名称',
    'legend.pickColor': '选择颜色',
    'legend.add': '添加',
    'blitz.title': '城市闪电战规划器',
    'blitz.modes.planning': '规划',
    'blitz.modes.action': '行动',
    'toolbar.data': '数据',
    'toolbar.actions': '操作',
    'toolbar.filters': '筛选',
    'toolbar.theme': '主题',
    'btn.saveNow': '立即保存',
    'btn.reloadFromServer': '从服务器重新加载',
    'btn.exportAccountData': '导出账户数据',
    'btn.export': '导出',
    'btn.import': '导入',
    'btn.shareMap': '分享地图...',
    'controls.manualStepper': '手动步骤',
    'controls.capture': '占领',
    'controls.release': '释放',
    'controls.play': '播放',
    'controls.pause': '暂停',
    'actions.clearFuture': '清除未来',
    'actions.clearAll': '全部清除',
    'actions.undoClear': '撤销清除',
    'planning.clearPlan': '清除计划',
    'planning.undoClearPlan': '撤销清除计划',
    'filters.allianceFilter': '联盟筛选',
    'filters.all': '全部',
    'theme.light': '浅色',
    'theme.dark': '深色',
    'strike.title': '阵营打击计划',
    'tabs.active': '进行中',
    'tabs.proposed': '已提议',
    'tabs.history': '历史',
    'labels.myFaction': '我的阵营',
    'labels.targeting': '目标阵营',
    'ui.attackerSelect': '选择进攻联盟…',
    'ui.reset': '重置当前周期',
    'table.rank': '#',
    'table.target': '目标',
    'table.interest': '意向',
    'table.action': '操作',
    'bracket.b1': '分档1 (1–3)',
    'bracket.b2': '分档2 (4–6)',
    'bracket.b3': '分档3 (7–9)',
    'bracket.b4': '分档4 (10–12)',
    'bracket.b5': '分档5 (13–15)',
    'bracket.b6': '分档6 (16–18)',
    'bracket.b7': '分档7 (19–20)',
    'interest.none': '无',
    'actions.interested': '有意向',
    'actions.withdraw': '撤回',
    'tooltips.markInterest': '标记意向',
    'tooltips.bracketMismatch': '分档不匹配',
  },
  th: {
    'legend.alliances': 'พันธมิตร',
    'legend.filterByAlliance': 'กรองตามพันธมิตร',
    'legend.holdings': 'ครอบครอง',
    'legend.today': 'วันนี้',
    'legend.details': 'รายละเอียด',
    'legend.color': 'สี',
    'legend.priority': 'ลำดับความสำคัญ',
    'legend.remove': 'ลบพันธมิตร',
    'legend.allianceName': 'ชื่อพันธมิตร',
    'legend.pickColor': 'เลือกสี',
    'legend.add': 'เพิ่ม',
    'blitz.title': 'ตัววางแผน City Blitz',
    'blitz.modes.planning': 'การวางแผน',
    'blitz.modes.action': 'การปฏิบัติการ',
    'toolbar.data': 'ข้อมูล',
    'toolbar.actions': 'การดำเนินการ',
    'toolbar.filters': 'ตัวกรอง',
    'toolbar.theme': 'ธีม',
    'btn.saveNow': 'บันทึกทันที',
    'btn.reloadFromServer': 'โหลดจากเซิร์ฟเวอร์อีกครั้ง',
    'btn.exportAccountData': 'ส่งออกข้อมูลบัญชี',
    'btn.export': 'ส่งออก',
    'btn.import': 'นำเข้า',
    'btn.shareMap': 'แชร์แผนที่...',
    'controls.manualStepper': 'ขั้นตอนด้วยตนเอง',
    'controls.capture': 'ยึดครอง',
    'controls.release': 'ปล่อย',
    'controls.play': 'เล่น',
    'controls.pause': 'หยุดชั่วคราว',
    'actions.clearFuture': 'ล้างอนาคต',
    'actions.clearAll': 'ล้างทั้งหมด',
    'actions.undoClear': 'เลิกทำการล้าง',
    'planning.clearPlan': 'ล้างแผน',
    'planning.undoClearPlan': 'เลิกทำการล้างแผน',
    'filters.allianceFilter': 'ตัวกรองพันธมิตร',
    'filters.all': 'ทั้งหมด',
    'theme.light': 'สว่าง',
    'theme.dark': 'มืด',
    'strike.title': 'ตัววางแผนการโจมตีของฝ่าย',
    'tabs.active': 'กำลังดำเนินการ',
    'tabs.proposed': 'เสนอไว้',
    'tabs.history': 'ประวัติ',
    'labels.myFaction': 'ฝ่ายของฉัน',
    'labels.targeting': 'ฝ่ายเป้าหมาย',
    'ui.attackerSelect': 'เลือกพันธมิตรผู้โจมตี…',
    'ui.reset': 'รีเซ็ตรอบปัจจุบัน',
    'table.rank': '#',
    'table.target': 'เป้าหมาย',
    'table.interest': 'ความสนใจ',
    'table.action': 'การดำเนินการ',
    'bracket.b1': 'ระดับ 1 (1–3)',
    'bracket.b2': 'ระดับ 2 (4–6)',
    'bracket.b3': 'ระดับ 3 (7–9)',
    'bracket.b4': 'ระดับ 4 (10–12)',
    'bracket.b5': 'ระดับ 5 (13–15)',
    'bracket.b6': 'ระดับ 6 (16–18)',
    'bracket.b7': 'ระดับ 7 (19–20)',
    'interest.none': 'ไม่มี',
    'actions.interested': 'แสดงความสนใจ',
    'actions.withdraw': 'ถอน',
    'tooltips.markInterest': 'ทำเครื่องหมายความสนใจ',
    'tooltips.bracketMismatch': 'ระดับไม่ตรงกัน',
  },
};

type Ctx = {
  lang: Lang;
  setLang: (l: Lang) => void;
  t: (key: string) => string;
  langs: Array<{ code: Lang; name: string }>;
};

const I18nContext = createContext<Ctx | null>(null);

export function I18nProvider({ children }: { children: any }) {
  const saved = (typeof window !== 'undefined' ? (localStorage.getItem('lang') as Lang | null) : null) || 'en';
  const [lang, setLangState] = useState<Lang>(saved);
  const setLang = (l: Lang) => { setLangState(l); if (typeof window !== 'undefined') localStorage.setItem('lang', l); };
  const t = (key: string) => (dictionaries[lang] && dictionaries[lang][key]) || (dictionaries['en'][key] || key);
  const langs = useMemo(() => ([
    { code: 'en', name: 'English' },
    { code: 'ko', name: '한국어' },
    { code: 'zh-CN', name: '简体中文' },
    { code: 'th', name: 'ไทย' },
  ]), []);
  const value: Ctx = { lang, setLang, t, langs };
  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}

export function useI18n() {
  const ctx = useContext(I18nContext);
  if (!ctx) throw new Error('I18nProvider missing');
  return ctx;
}

